<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>INTRACKSTATE Include File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.0.0 on Thu Jan 27 18:50:20 2000 -->
<center>
<a class="qindex"href="index.html">Main Page</a> &nbsp; <a class="qindex"href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex"href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex"href="annotated.html">Compound List</a> &nbsp; <a class="qindex"href="files.html">File List</a> &nbsp; <a class="qindex"href="headers.html">Header Files</a> &nbsp; <a class="qindex"href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex"href="functions.html">Compound Members</a> &nbsp; <a class="qindex"href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>midstuff.h</h1>This is the verbatim text of the midstuff.h include file.<div class="fragment"><pre>/*==========================================================================
 *
 *  Copyright (C) 1995-1997 Microsoft Corporation. All Rights Reserved.
 *
 *  File:       midstuff.h
 *  Content:    MIDI structures and definitions used by the MSTREAM sample
 *              application in converting a MID file to a MIDI stream for
 *              playback using the midiStream API.
 *
 ***************************************************************************/
#ifndef __MIDSTUFF_H__
#define __MIDSTUFF_H__

// MIDI file constants
//
#define MThd            0x6468544D              // Start of file
#define MTrk            0x6B72544D              // Start of track

#define MIDI_SYSEX      ((BYTE)0xF0)            // SysEx begin
#define MIDI_SYSEXEND   ((BYTE)0xF7)            // SysEx begin
#define MIDI_META       ((BYTE)0xFF)            // Meta event begin
#define MIDI_META_TEMPO ((BYTE)0x51)            // Tempo change
#define MIDI_META_EOT   ((BYTE)0x2F)            // End-of-track

#define MIDI_NOTEOFF    ((BYTE)0x80)            // + note + velocity
#define MIDI_NOTEON     ((BYTE)0x90)            // + note + velocity
#define MIDI_POLYPRESS  ((BYTE)0xA0)            // + pressure (2 bytes)
#define MIDI_CTRLCHANGE ((BYTE)0xB0)            // + ctrlr + value
#define MIDI_PRGMCHANGE ((BYTE)0xC0)            // + new patch
#define MIDI_CHANPRESS  ((BYTE)0xD0)            // + pressure (1 byte)
#define MIDI_PITCHBEND  ((BYTE)0xE0)            // + pitch bend (2 bytes)

#define NUM_CHANNELS    16

#define MIDICTRL_VOLUME         ((BYTE)0x07)
#define MIDICTRL_VOLUME_LSB     ((BYTE)0x27)
#define MIDICTRL_PAN            ((BYTE)0x0A)

#define MIDIEVENT_CHANNEL(dw)   (dw &amp; 0x0000000F)
#define MIDIEVENT_TYPE(dw)      (dw &amp; 0x000000F0)
#define MIDIEVENT_DATA1(dw)     ((dw &amp; 0x0000FF00) &gt;&gt; 8)
#define MIDIEVENT_VOLUME(dw)    ((dw &amp; 0x007F0000) &gt;&gt; 16)

// Macros for swapping hi/lo-endian data
//
#define WORDSWAP(w)     (((w) &gt;&gt; 8) | \
                        (((w) &lt;&lt; 8) &amp; 0xFF00))

#define DWORDSWAP(dw)   (((dw) &gt;&gt; 24) |                 \
                        (((dw) &gt;&gt; 8) &amp; 0x0000FF00) |    \
                        (((dw) &lt;&lt; 8) &amp; 0x00FF0000) |    \
                        (((dw) &lt;&lt; 24) &amp; 0xFF000000))

// In debug builds, TRACKERR will show us where the parser died
//
#ifdef DEBUG
#define TRACKERR(p,sz) ShowTrackError(p,sz);
#else
#define TRACKERR(p,sz)
#endif


// Make a little distinction here so the various structure members are a bit
// more clearly labelled -- we have offsets and byte counts to keep track of
// that deal with both in-memory buffers and the file on disk

#define FILEOFF DWORD
                        

// These structures are stored in MIDI files; they need to be byte aligned.
//
#pragma pack(1)

// Chunk header. dwTag is either MTrk or MThd.
//
typedef struct
{
    DWORD       dwTag;                  // Type
    DWORD       dwChunkLength;          // Length (hi-lo)
} <a class="code" href="class_midichunk.html">MIDICHUNK</a>;

// Contents of MThd chunk.
typedef struct
{
    WORD        wFormat;                // Format (hi-lo)
    WORD        wTrackCount;            // # tracks (hi-lo)
    WORD        wTimeDivision;          // Time division (hi-lo)
} <a class="code" href="class_midifilehdr.html">MIDIFILEHDR</a>;

#pragma pack() // End of need for byte-aligned structures


// Temporary event structure which stores event data until we're ready to
// dump it into a stream buffer
//
typedef struct
{
    DWORD       tkEvent;        // Absolute time of event
    BYTE        byShortData[4]; // Event type and parameters if channel msg
    DWORD       dwEventLength;  // Length of data which follows if meta or sysex
    LPBYTE      pLongData;      // -&gt; Event data if applicable
} <a class="code" href="class_tempevent.html">TEMPEVENT</a>, *PTEMPEVENT;

#define ITS_F_ENDOFTRK  0x00000001

// Description of a track open for read
//
typedef struct
{
    DWORD       fdwTrack;       // Track status
    DWORD       dwTrackLength;  // Total bytes in track
    DWORD       dwLeftInBuffer; // Bytes left unread in track buffer
    LPBYTE      pTrackStart;    // -&gt; start of track data buffer
    LPBYTE      pTrackCurrent;  // -&gt; next byte to read in buffer
    DWORD       tkNextEventDue; // Absolute time of next event in track
    BYTE        byRunningStatus;// Running status from last channel msg

    FILEOFF     foTrackStart;   // Start of track -- used for walking the file
    FILEOFF     foNextReadStart;// File offset of next read from disk
    DWORD       dwLeftOnDisk;   // Bytes left unread on disk
#ifdef DEBUG
    DWORD       nTrack;         // # of this track for debugging
#endif
} <a class="code" href="class_intrackstate.html">INTRACKSTATE</a>, *PINTRACKSTATE;

// Description of the input MIDI file
//
typedef struct
{
    DWORD       cbFileLength;           // Total bytes in file
    DWORD       dwTimeDivision;         // Original time division
    DWORD       dwFormat;               // Original format
    DWORD       dwTrackCount;           // Track count (specifies pitsTracks size)
    <a class="code" href="class_intrackstate.html">INTRACKSTATE</a> *pitsTracks;           // -&gt; array of tracks in this file
} <a class="code" href="class_infilestate.html">INFILESTATE</a>, *PINFILESTATE;

#endif

</div></pre><hr><address><small>Generated at Thu Jan 27 18:50:20 2000 for blaxxunContact3D by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=118 height=53></a> 1.0.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-1999</small></address>
</body>
</html>
