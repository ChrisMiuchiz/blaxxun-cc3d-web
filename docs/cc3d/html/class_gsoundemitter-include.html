<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>GSoundEmitter Include File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.0.0 on Thu Jan 27 18:46:27 2000 -->
<center>
<a class="qindex"href="index.html">Main Page</a> &nbsp; <a class="qindex"href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex"href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex"href="annotated.html">Compound List</a> &nbsp; <a class="qindex"href="files.html">File List</a> &nbsp; <a class="qindex"href="headers.html">Header Files</a> &nbsp; <a class="qindex"href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex"href="functions.html">Compound Members</a> &nbsp; <a class="qindex"href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>gsound.h</h1>This is the verbatim text of the gsound.h include file.<div class="fragment"><pre>/*=============================================================================

This code is licensed under the Web3D-blaxxun Community Source License,
provided in distribution file LICENSE.TXT and available online at
http://www.web3D.org/TaskGroups/x3d/blaxxun/Web3D-blaxxunCommunitySourceAgreement.html
and may only be used for non-commercial use as specified in that license.

THE WEB3D CONSORTIUM AND BLAXXUN DO NOT MAKE AND HEREBY DISCLAIM ANY EXPRESS
OR IMPLIED WARRANTIES RELATING TO THIS CODE, INCLUDING BUT NOT LIMITED TO,
WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE, OR ANY WARRANTIES THAT MIGHT ARISE FROM A COURSE OF DEALING, USAGE
OR TRADE PRACTICE.  THE COMMUNITY SOURCE CODE IS PROVIDED UNDER THIS
AGREEMENT "AS IS," WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
INCLUDING, WITHOUT LIMITATION, WARRANTIES THAT THE COMMUNITY SOURCE CODE ARE
FREE OF DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR
NON-INFRINGING OR IN ANY WAY CONSTITUTE THE COMPLETE PRODUCT MARKETED UNDER
THE NAMES GIVEN SAID CODE.

==============================================================================*/
#ifndef _GSound_h
#define _GSound_h

/******************************************************************************
@doc

@module GSound.h - abstract sound device|

Copyright (c) 1997- 1998        by  blaxxun interactive - Holger Grahn 
All rights reserved

Purpose:
Abstract root classes for a sound device

actual sound implementation devices are GRSXSound.cpp and GDSSound.cpp

Classes:
&lt;c GSoundDevice&gt;
&lt;c GSoundEmitter&gt;


Notes:


  Think about extension for streaming
          SoundEmmitter::AddSound(newSoundData)
  
  Think about extension for sound capture
          SoundDevice::Capture ...


Changes:

$Revision: 1.17 $
$Log: gsound.h,v $
Revision 1.17  1999/07/06 16:55:04  tom
*** empty log message ***



Todo :

   remove RSX datatypes
   
******************************************************************************/



// #include "rsx.h"

#ifdef WIN32
#include "mmsystem.h"
#endif


class <a class="code" href="class_gsounddevice.html">GSoundDevice</a>;
class <a class="code" href="class_gsoundemitter.html">GSoundEmitter</a>;


#define GS_QUALITY_NO3D 0
#define GS_QUALITY_MIN 1
#define GS_QUALITY_MID 2
#define GS_QUALITY_MAX 3


enum GSErrorCodes {
        GS_NOT_PCM_FORMAT=100, // WAV is not PCM format
        GS_FILE_NOT_FOUND,      // file error 
        GS_FILE_ERROR,          // file system error 
        GS_FILE_TRUNCATED,      // WAV is truncated 
        GS_FILE_BAD,            // BAD data 

};


// GSoundDevice
// all datastructures for a sound playing device
//



class <a class="code" href="class_gsounddevice.html">GSoundDevice</a> : public <a class="code" href="class_rtroot.html">RTRoot</a> {

public :

        <a class="code" href="class_gsounddevice.html#a0">RT</a>(<a class="code" href="class_gsounddevice.html">GSoundDevice</a>);

        BOOL                                    m_use3d;        
        
        BOOL                                    m_needCommit; 
        
        BOOL                                    m_soundListChanged; 

        <a class="code" href="class_point.html">Point</a>                                   m_position,m_direction,m_up;
        
        DWORD                                   m_time; 
        
        int                                             m_activeSounds; 

        int m_quality; 

        virtual void <a class="code" href="class_gsounddevice.html#a1">SetQuality</a>(int quality)=0;

        // RSX specials 
        float                                   m_speedOfSound;

        virtual int <a class="code" href="class_gsounddevice.html#a2">SetNumActiveSounds</a>(int num)=0;

        int                                             m_numEnabledSounds;
        
        BOOL                                    m_passUrl;


        <a class="code" href="class_gsounddevice.html#a3">GSoundDevice</a>();

        virtual <a class="code" href="class_gsounddevice.html#a4">~GSoundDevice</a>();


        virtual BOOL <a class="code" href="class_gsounddevice.html#a5">Ok</a>() const=0;

        void <a class="code" href="class_gsounddevice.html#a6">NeedCommit</a>() { m_needCommit = TRUE; }

        void <a class="code" href="class_gsounddevice.html#a7">SoundListChanged</a>() { m_soundListChanged = TRUE; }

        virtual BOOL <a class="code" href="class_gsounddevice.html#a8">CheckCommit</a>();


        virtual BOOL <a class="code" href="class_gsounddevice.html#a9">Initialize</a>(HWND mainWnd) = 0;

        virtual void <a class="code" href="class_gsounddevice.html#a10">Term</a>()=0;

        virtual void <a class="code" href="class_gsounddevice.html#a11">Release</a>();

        virtual void <a class="code" href="class_gsounddevice.html#a12">SetViewpoint</a>(const <a class="code" href="class_point.html">Point</a> &amp;position,const <a class="code" href="class_vector.html">Vector</a> &amp;direction,const <a class="code" href="class_vector.html">Vector</a> &amp;up,DWORD time)=0;

        virtual BOOL <a class="code" href="class_gsounddevice.html#a13">PlaySound</a>(const char *fileName)=0;
         
        virtual <a class="code" href="class_gsoundemitter.html">GSoundEmitter</a>* <a class="code" href="class_gsounddevice.html#a14">newSoundEmitter</a>(int fileFmt= 0)=0;


/*
TO be done by implementers of a GSoundDevice 

        // emitters allocated 
        GSoundEmitter* m_emitters;


        // emitter for PlaySound
        GSoundEmitter* m_playEmitter;

        // add new emitter 
        virtual void Add(GSoundEmitter *emitter)=0;

        // remove emitter 
        virtual BOOL Remove(GSoundEmitter *emitter)=0;
*/

        virtual void <a class="code" href="class_gsounddevice.html#a15">RemoveEmitters</a>()=0;


        virtual void <a class="code" href="class_gsounddevice.html#a16">ReleaseEmitters</a>()=0;

        virtual void <a class="code" href="class_gsounddevice.html#a17">DisableUnusedEmitters</a>()=0;

        virtual void <a class="code" href="class_gsounddevice.html#a18">ResetEmittersUseFlag</a>()=0;

        // disable (mute) all others 
        virtual int <a class="code" href="class_gsounddevice.html#a19">PrioritizeSounds</a>()=0;

        static DWORD maxUpdateIntervall;  
        
        static int defaultMaxSounds; 
        
        // the default CPU-Budget (RSX)
        static int defaultCpuBudget; 
};




//
// GSoundEmitter 
// the class representing a sound to be played 
//

class <a class="code" href="class_gsoundemitter.html">GSoundEmitter</a> {

public:

    // This class has two modes of operation. 

    typedef enum {
        e_SimpleWav= 1,
        e_Streaming
    } mt_Mode;

    mt_Mode m_Mode;

    virtual BOOL <a class="code" href="class_gsoundemitter.html#a0">CanDoStreaming</a>()    { return FALSE; };
                                    // If a derived class implements all
                                    // functions, which are needed for streaming,
                                    // this must return TRUE. 

    
        <a class="code" href="class_point.html">Point</a>                                   m_position,m_direction;
        float                                   m_pitch;

        //GSoundEmitter * m_next; // linked list 

        LONG m_refCnt;
    int <a class="code" href="class_gsoundemitter.html#a1">ref</a>() { 
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: \n");
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: &gt;&gt;&gt; GSoundEmitter&lt;%08x&gt;::ref() \n", this);
        LONG ret= InterlockedIncrement(&amp;m_refCnt); 
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: m_refCnt&lt;%d&gt; (after increment) \n", m_refCnt);
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: &lt;&lt;&lt; GSoundEmitter&lt;%08x&gt;::ref() \n", this);
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: \n");
    return ret;
    }

 void <a class="code" href="class_gsoundemitter.html#a2">unref</a>() {
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: \n");
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: &gt;&gt;&gt; GSoundEmitter&lt;%08x&gt;::unref() \n", this);
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: m_refCnt&lt;%d&gt; (before Decrementing) \n", m_refCnt);
        if (InterlockedDecrement(&amp;m_refCnt) &lt;= 0) 
        {
            <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: &gt;&gt;&gt; deleting this (GSoundEmitter)\n");
            delete this; 
        }
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: &lt;&lt;&lt; GSoundEmitter&lt;%08x&gt;::unref() \n", this);
        <a class="code" href="grmaplay.h.html#a0">TRACE</a>("SDHM: \n");
    }


        HRESULT m_result; 

        BOOL m_enabled; 
        
        DWORD m_enabledTime; 


        BOOL <a class="code" href="class_gsoundemitter.html#a3">IsEnabled</a>() const { return m_enabled; }

    BOOL <a class="code" href="class_gsoundemitter.html#a4">HasStreamingMode</a>() const { return m_Mode == e_Streaming; };

        BOOL m_muted;   


        virtual void <a class="code" href="class_gsoundemitter.html#a5">SetMuteState</a>(BOOL flag)=0;


        float m_priority; 
        
        float m_intensity; 

        virtual float <a class="code" href="class_gsoundemitter.html#a6">getValue</a>()=0; 


        unsigned m_used;

        void <a class="code" href="class_gsoundemitter.html#a7">SetUsed</a>() { m_used ++; }
        
        void <a class="code" href="class_gsoundemitter.html#a8">SetUnused</a>() { m_used =0; }

        BOOL <a class="code" href="class_gsoundemitter.html#a9">IsUsed</a>() const { return (m_used&gt;0); }


        <a class="code" href="class_gsoundemitter.html#a10">GSoundEmitter</a>();
        
        virtual <a class="code" href="class_gsoundemitter.html#a11">~GSoundEmitter</a>();

        virtual BOOL <a class="code" href="class_gsoundemitter.html#a12">Ok</a>()=0;

        virtual void <a class="code" href="class_gsoundemitter.html#a13">Enable</a>(BOOL flag)=0;
                
        virtual void <a class="code" href="class_gsoundemitter.html#a14">SetModel</a>(
                float                   fMinBack,
                float                   fMinFront,
                float                   fMaxBack,
                float                   fMaxFront,
                float                   fIntensity
                )=0;


        virtual BOOL <a class="code" href="class_gsoundemitter.html#a15">Initialize</a>(<a class="code" href="class_gsounddevice.html">GSoundDevice</a> *device, const char *fileName, BOOL spatialize=FALSE)=0; // For simple playing a wav file.
    virtual BOOL <a class="code" href="class_gsoundemitter.html#a15">Initialize</a>(<a class="code" href="class_gsounddevice.html">GSoundDevice</a> *device, DWORD Frequency, DWORD Channels, DWORD BitsPerSample, double BufferLength, BOOL spatialize= FALSE);  // For streaming sound.      // BufferLength is the required Length of the buffer in seconds.
    // for implementors: the first Initialize(.) function must set m_Mode to e_SimpleWav, the second one to e_Streaming.


        virtual BOOL <a class="code" href="class_gsoundemitter.html#a17">QueryInfo</a>(BOOL &amp;playing,float &amp;secondsPlayed,float &amp;totalSeconds, int &amp;numLoops,float &amp;level)=0;

        virtual void <a class="code" href="class_gsoundemitter.html#a18">Play</a>(BOOL loop=TRUE, float initialStartTime=0.0f)=0;
    // In e_Streaming mode, initialStartTime has no meaning.

        virtual void <a class="code" href="class_gsoundemitter.html#a19">Stop</a>()=0;

        /* GetMarkPosition retrieves the begin and end playback mark. 
           begin = 0 from begin end = 0 to end of file 
           rsx only ?
        */
        virtual void <a class="code" href="class_gsoundemitter.html#a20">GetMarkPosition</a>(float &amp;beginTime, float &amp;endTime)=0;
        
        virtual void <a class="code" href="class_gsoundemitter.html#a21">SetMarkPosition</a>(float beginTime=0.0f, float endTime=0.0f)=0;

        virtual void <a class="code" href="class_gsoundemitter.html#a22">GetPitch</a>(float &amp;pitchFactor)=0;

        virtual void <a class="code" href="class_gsoundemitter.html#a23">SetPitch</a>(float pitchFactor=1.0f)=0;


        virtual void <a class="code" href="class_gsoundemitter.html#a24">SetPosition</a>(const <a class="code" href="class_point.html">Point</a> &amp;position)=0;

        virtual void <a class="code" href="class_gsoundemitter.html#a25">SetOrientation</a> (const <a class="code" href="class_point.html">Point</a> &amp;direction)=0;

        virtual void <a class="code" href="class_gsoundemitter.html#a26">Release</a>();

















    // See the implementation, why these are no pure virtual functions:

public:     
  virtual DWORD <a class="code" href="class_gsoundemitter.html#a27">WriteData</a>(char *Data, DWORD Len); // Locks the Buffer, writes the data
                                                  // and unlocks it again.

  virtual DWORD <a class="code" href="class_gsoundemitter.html#a28">ZeroWrite</a>(DWORD Count); // Locks the Buffer, writes Count bytes of zero
                                        // and unlocks it again.
                           
  
  
  virtual DWORD <a class="code" href="class_gsoundemitter.html#a29">getSaveCursor</a>();  // returns the byte offset to the play
                                  //  cursor, from where it is save to write.
  virtual double <a class="code" href="class_gsoundemitter.html#a30">getSaveCursorSec</a>(); // the same as getSaveCursor(), but in seconds.


  virtual DWORD <a class="code" href="class_gsoundemitter.html#a31">getWriteCursor</a>();  // returns the byte offset to the play cursor,
                                   // where the next data will be written. This
                                   // is also a measurement how full the buffer is.
                                   // Since the Play Cursor constantly moves towards
                                   // the Write Cursor, this value may decrease
                                   // between subsequent calls.
  virtual double <a class="code" href="class_gsoundemitter.html#a32">getWriteCursorSec</a>(); // the same as getWriteCursor(), but in seconds.
                                      // This tells how long it will last, untill
                                      // Data which would have now been written to
                                      // the buffer will be actually played. (It doesn't
                                      // contain the delay in the primary DSound buffer
                                      // - if there is any, I don't know.)

  virtual DWORD <a class="code" href="class_gsoundemitter.html#a33">getBufferLength</a>(); // returns the size of the buffer in bytes.


  virtual double <a class="code" href="class_gsoundemitter.html#a34">getBufferLengthSec</a>(); // return the size of the buffer in Seconds.
                                       // This is what was passed to the constructor.

  virtual DWORD <a class="code" href="class_gsoundemitter.html#a35">getBytesPerSec</a>();

  virtual void <a class="code" href="class_gsoundemitter.html#a36">DecreaseWriteCursor</a>(int delta); // This decreases the WriteCursor by
                                               // the given amount of Bytes. This
                                               // could be used if some Data should
                                               // be rewritten to the buffer.
                                               // it is also possible to specify a
                                               // negative value for delta, which
                                               // will skip some data. But it could
                                               // be better to write Zeroes, or something
                                               // else. Another usage for negative delta
                                               // could be to jump back after rewriting
                                               // some earlier data. But this in not
                                               // necessary if you write as much data
                                               // as you jumped back.
                                               //
                                               // This only works for values smaller
                                               // than the size of the buffer.
  
                                               //Note: Lock() doesn't increase the WriteCursor, but UnLock() does.

                                   

// Data Members for buffer handling:

protected:
    // none in this base class.



};



#endif
</div></pre><hr><address><small>Generated at Thu Jan 27 18:46:27 2000 for blaxxunContact3D by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=118 height=53></a> 1.0.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-1999</small></address>
</body>
</html>
