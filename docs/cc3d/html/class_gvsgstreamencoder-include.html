<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<title>GvSGStreamEncoder Include File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.0.0 on Thu Jan 27 18:49:45 2000 -->
<center>
<a class="qindex"href="index.html">Main Page</a> &nbsp; <a class="qindex"href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex"href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex"href="annotated.html">Compound List</a> &nbsp; <a class="qindex"href="files.html">File List</a> &nbsp; <a class="qindex"href="headers.html">Header Files</a> &nbsp; <a class="qindex"href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex"href="functions.html">Compound Members</a> &nbsp; <a class="qindex"href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>gvsgstream.h</h1>This is the verbatim text of the gvsgstream.h include file.<div class="fragment"><pre>#ifndef  _GvSGStream_h_
#define  _GvSGStream_h_

/******************************************************************************
@doc

@module GvSGStream.h - blaxxun binary VRML stream|

Copyright (c) 1999 - 1999 blaxxun interactive, Holger Grahn
All rights reserved

Purpose:

Classes:
&lt;c GvCompiledGroup&gt;
  
Notes:

Changes:

$Revision: $
$Log: $

Todo :

******************************************************************************/


#include &lt;GvSFNode.h&gt;
#include &lt;GvMFNode.h&gt;

#include &lt;GvMFInt32.h&gt;

#include &lt;GvWWWInline.h&gt;

// forward
class <a class="code" href="class_gfilemap.html">GFileMap</a>;
class <a class="code" href="class_gstreamdescstream.html">GStreamDescStream</a>;
class GMyDisplayListPacket;

//#include "gdisplaylist.h"

// encoding types for all builtin field types

//....






class <a class="code" href="class_gvsgfieldinfo.html">GvSGFieldInfo</a> {

public:
        int internalFieldId: // the index into the GvFieldInfo of the node



        <a class="code" href="class_typeid.html">TypeId</a>          eventTypeId;    // the event/field type GvSFString ...
        GvFieldType type;                       // type of event/field
        GvFieldClass fieldClass;        // we need this for VRML script 
        
        <a class="code" href="class_gvfield.html">GvField</a>         *defaultValue; // the default value 
        
        int encoding;           

        // encoder specific data here :


};


typedef enum {
        GVSGFID_BYTE7,  // 7 bits, one bit left for encoding of SFBool
        GVSGFID_BYTE,
        GVSGFID_WORD15, // 15 bits, one bit left for encoding of SFBool
        
        // GVSFFID_BITS,        // use fieldIdBits bits


} GvSGFieldIdEncoding;

typedef enum {
        GVSGNID_BYTE,   // one unsigned byte
        GVSGNID_WORD,   // one unsigned word 
        GVSGNID_INT,    // one unsigned int
} GvSGNodeIdEncoding;

// node type/value encoding

typedef enum {
        GVSGNT_BYTE6,   // 6 bits, upper 2 bits: 0: normal, 1, NULL, 2:DEF ,3 USE
        GVSGNT_WORD14,  // 14 bits, upper 2 bits: 0: normal, 1, NULL, 2:DEF ,3 USE
        GVSGNT_INT30,   // 14 bits, upper 2 bits: 0: normal, 1, NULL, 2:DEF ,3 USE
        
}       GvSGNodeTypeEncoding;


class <a class="code" href="class_gvsgnodeinfo.html">GvSGNodeInfo</a> 
{

        int fieldIdBits;        // number of bits
        
        GvSGFieldIdEncoding fieldIdEncoding; // how field ids are encoded

        <a class="code" href="class_gvfielddata.html">GvFieldData</a> *fieldData;

        <a class="code" href="class_array.html">Array</a>&lt;<a class="code" href="class_gvsgfieldinfo.html">GvSGFieldInfo</a>*&gt; fieldInfo; // encoding info for fields, directly indexed by fieldId


        // is this a proto/externproto node
        gvBool isProto;
        <a class="code" href="class_gvproto.html">GvProto</a> *proto; //&lt; the proto definition

        // the type id, has the new() member is used to crate a node instance
        <a class="code" href="class_typeid.html">TypeId</a> nodeClassId;


        <a class="code" href="class_gvsgnodeinfo.html#c0">GvSGNodeInfo</a>() : fieldIdBits(8),fieldIdEncoding(GVSGFID_BYTE7),fieldData(NULL),isProto(gfalse),proto(NULL) {}
        <a class="code" href="class_gvsgnodeinfo.html#c1">~GvSGNodeInfo</a>() {};

        // create an instance for the node
        <a class="code" href="class_gvnode.html">GvNode</a> *<a class="code" href="class_gvsgnodeinfo.html#c2">createInstance</a>()
        {
                if (isProto) return proto-&gt;NewInstance()
                <a class="code" href="class_gvnode.html">GvNode</a> *n = (<a class="code" href="class_gvnode.html">GvNode</a> *) nodeClassID.New();
                
                if (fieldData == NULL) // setup field data
                        fieldData = n-&gt;<a class="code" href="class_gvnode.html#a19">getFieldData</a>();
                return n;

        }

        // set node info as beeing instances of given proto argument
        void <a class="code" href="class_gvsgnodeinfo.html#c3">setProto</a> (<a class="code" href="class_gvproto.html">GvProto</a> *p) {
                proto = p;
                isProto = (proto != NULL);
                fieldData=p-&gt;<a class="code" href="class_gvnode.html#a19">getFieldData</a>();
        }

        // encode data
        int maxNumFields; // max number of used fields in file


};


class <a class="code" href="class_gvsgstreamdecoder.html">GvSGStreamDecoder</a> 
{

public:



        int <a class="code" href="class_gvsgstreamdecoder.html#a0">readField</a>(<a class="code" href="class_gvfield.html">GvField</a> *field,<a class="code" href="class_gvsgfieldinfo.html">GvSGFieldInfo</a>*fieldInfo);

        int <a class="code" href="class_gvsgstreamdecoder.html#a1">readNodeInstance</a>(<a class="code" href="class_gvnode.html">GvNode</a> *node,<a class="code" href="class_gvsgnodeinfo.html">GvSGNodeInfo</a> *nodeInfo);
        /*
                &lt;numFields&gt;

                (&lt;fieldId&gt; &lt;fieldValue&gt;)*
        */

        int <a class="code" href="class_gvsgstreamdecoder.html#a2">readNode</a>(<a class="code" href="class_gvnode.html">GvNode</a> **node);

        /*
                &lt;nodeType&amp;info&gt;

                if (use) &lt;readNodeId&gt;
                else {
                        if (def) &lt;readNodeId&gt;
                        // create node
                
                        &lt;readNodeInstace&gt;
                }

        */

        // basic types
        int <a class="code" href="class_gvsgstreamdecoder.html#a3">read</a>(int encoding, int num,float *buffer);
        
        int <a class="code" href="class_gvsgstreamdecoder.html#a3">read</a>(int encoding, int num,double *buffer);
        
        int <a class="code" href="class_gvsgstreamdecoder.html#a3">read</a>(int encoding, int num,int *buffer);

        int <a class="code" href="class_gvsgstreamdecoder.html#a3">read</a>(int encoding, int num,<a class="code" href="class_gvstring.html">GvString</a> *buffer);


        int <a class="code" href="class_gvsgstreamdecoder.html#a7">readNodes</a>(<a class="code" href="class_gvmfnode.html">GvMFNode</a> &amp;nodes);

        int <a class="code" href="class_gvsgstreamdecoder.html#a8">readProtos</a>(<a class="code" href="class_gvmfnode.html">GvMFNode</a> &amp;protos);
        
        int <a class="code" href="class_gvsgstreamdecoder.html#a9">readExternProtos</a>(<a class="code" href="class_gvmfnode.html">GvMFNode</a> &amp;protos);

        int <a class="code" href="class_gvsgstreamdecoder.html#a10">readRoutes</a>(<a class="code" href="class_gvmfnode.html">GvMFNode</a> &amp;routes);


        // meta block
        int <a class="code" href="class_gvsgstreamdecoder.html#a11">readNodeInfoTable</a>();


        int nodedIdBits;        
        GvSGNodeIdEncoding nodeIdEncoding; 

        int nodedTypeBits;      
        GvSGNodeTypeEncoding nodeTypeEncoding; // how node types are encoded


        <a class="code" href="class_array.html">Array</a>&lt;GvSGNode*&gt; nodeInfo; // encoding info for fields, directly indexed by fieldId

        // node dictonary index by typeId


};


/*

file :

        &lt;encoding info for stream&gt; 

        // chunks updating nodeInfo of stream
        &lt;nodeInfoTable&gt;
        &lt;protoBlock&gt;
        &lt;externprotoBlock&gt;

        &lt;nameBlock&gt;
        &lt;nodeIdNameTable&gt; 

        &lt;topLevelSceneNodes&gt;

        &lt;routes&gt;
        
        &lt;scenegraphupdatecommands&gt;


*/



class <a class="code" href="class_gvsgstreamencoder.html">GvSGStreamEncoder</a>
{

public:
        // statistics
        int numNodes;

        int numNodeTypes;
        int maxFieldsPerNode;

        // correspoding structures from decoder


        int nodedIdBits;        
        GvSGNodeIdEncoding nodeIdEncoding; 

        int nodedTypeBits;      
        GvSGNodeTypeEncoding nodeTypeEncoding; // how node types are encoded


        <a class="code" href="class_array.html">Array</a>&lt;GvSGNode*&gt; nodeInfo; // encoding info for fields, directly indexed by fieldId

        // node dictonary index by typeId

        // preprocess path
        
        // do we already know this nodetype ??
        gbool <a class="code" href="class_gvsgstreamencoder.html#a0">isNodeTypeDefined</a>(<a class="code" href="class_typeid.html">TypeId</a> id) 
        {
                for (int i=0; i&lt;nodeInfo.<a class="code" href="class_array.html#a21">Length</a>(); i++) {
                        GvSGNode &amp;n = *(nodeInfo[i]);
                        if (!n.isProto &amp;&amp; n.nodeClassId == id) return gtrue;
                }
                return gfalse;
        }
        
        // do we already know this nodetype proto ??
        gbool <a class="code" href="class_gvsgstreamencoder.html#a0">isNodeTypeDefined</a>(<a class="code" href="class_gvproto.html">GvProto</a> *proto) 
        {
                for (int i=0; i&lt;nodeInfo.<a class="code" href="class_array.html#a21">Length</a>(); i++) {
                        GvSGNode &amp;n = *(nodeInfo[i]);
                        if (n.isProto &amp;&amp; n.proto == proto) return gtrue;
                }
                return gfalse;
        }

        //
        int <a class="code" href="class_gvsgstreamencoder.html#a2">preprocessNode</a>(<a class="code" href="class_gvnode.html">GvNode</a> *n);
        int <a class="code" href="class_gvsgstreamencoder.html#a3">preprocessScene</a>(<a class="code" href="class_gvscene.html">GvScene</a> *n);


        void <a class="code" href="class_gvsgstreamencoder.html#a4">write</a>()
        {
                writeEncoderInfo();
                <a class="code" href="class_gvsgstreamencoder.html#a5">writeNodeInfoTable</a>();
                writeSceneGraphs();
        }

        void <a class="code" href="class_gvsgstreamencoder.html#a5">writeNodeInfoTable</a>()
        {
        }
        
        void <a class="code" href="class_gvsgstreamencoder.html#a6">writeProtos</a>(<a class="code" href="class_gvmfnode.html">GvMFNode</a> &amp;protos)
        {
        }

        void <a class="code" href="class_gvsgstreamencoder.html#a7">writeScene</a>(<a class="code" href="class_gvscene.html">GvScene</a> *scene)
        {
                <a class="code" href="class_gvsgstreamencoder.html#a6">writeProtos</a>(scene-&gt;protos);
                writeNodes(scene-&gt;children);
                writeRoutes(scene-&gt;routes);
        }

};








#endif  _GvSGStream_h 


</div></pre><hr><address><small>Generated at Thu Jan 27 18:49:45 2000 for blaxxunContact3D by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align=center border=0 
width=118 height=53></a> 1.0.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy; 1997-1999</small></address>
</body>
</html>
